<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="format-detection" content="telephone=no">
    <meta name="description" content="专业的中文宝宝起名服务，结合生辰八字、五行分析，为您的宝宝取个好名字">
    <meta name="keywords" content="宝宝起名,取名神器,八字起名,五行起名,婴儿取名">
    <meta name="author" content="中文取名神器">

    <!-- 小程序专用 -->
    <script>
    // 检测是否在小程序环境中
    function isMiniProgram() {
      return window.__wxjs_environment === 'miniprogram' || /miniProgram/i.test(navigator.userAgent);
    }

    // 如果在小程序中，通知小程序页面加载完成
    if (isMiniProgram()) {
      document.addEventListener('DOMContentLoaded', function() {
        if (window.wx && window.wx.miniProgram) {
          wx.miniProgram.postMessage({ data: { action: 'pageLoaded' } });
        }
      });
    }
    </script>
    <title>中文取名神器 - 专业的宝宝起名服务</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;
            background: linear-gradient(135deg, #8B4513 0%, #D2691E 50%, #F4A460 100%);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text x="50" y="50" font-size="100" fill="rgba(255,255,255,0.03)">福</text></svg>') repeat;
            pointer-events: none;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            border: 2px solid #8B4513;
        }

        .header h1 {
            font-size: 3em;
            color: #8B4513;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .header .subtitle {
            font-size: 1.2em;
            color: #666;
            margin-bottom: 20px;
        }

        .header .features {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
        }

        .feature {
            text-align: center;
            padding: 10px;
        }

        .feature i {
            font-size: 2em;
            color: #D2691E;
            margin-bottom: 5px;
        }

        .feature span {
            display: block;
            font-size: 0.9em;
            color: #666;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        .input-panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border: 2px solid #8B4513;
            height: fit-content;
        }

        .input-panel h2 {
            color: #8B4513;
            margin-bottom: 25px;
            font-size: 1.8em;
            text-align: center;
            border-bottom: 2px solid #8B4513;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: bold;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #D2691E;
            box-shadow: 0 0 0 3px rgba(210, 105, 30, 0.1);
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checkbox-item input[type="checkbox"] {
            width: auto;
        }

        .generate-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #8B4513 0%, #D2691E 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(139, 69, 19, 0.4);
        }

        .generate-btn:active {
            transform: translateY(0);
        }

        .results-panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border: 2px solid #8B4513;
        }

        .results-panel h2 {
            color: #8B4513;
            margin-bottom: 25px;
            font-size: 1.8em;
            text-align: center;
            border-bottom: 2px solid #8B4513;
            padding-bottom: 10px;
        }

        .bazi-info {
            background: rgba(210, 105, 30, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
            border-left: 4px solid #D2691E;
        }

        .bazi-info h3 {
            color: #8B4513;
            margin-bottom: 15px;
        }

        .bazi-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .bazi-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: white;
            border-radius: 8px;
            border: 1px solid #ddd;
        }

        .bazi-item .label {
            font-weight: bold;
            color: #666;
        }

        .bazi-item .value {
            color: #8B4513;
            font-weight: bold;
        }

        .wuxing-info {
            display: flex;
            justify-content: space-around;
            margin: 15px 0;
        }

        .wuxing-item {
            text-align: center;
            padding: 10px;
            border-radius: 8px;
            min-width: 60px;
        }

        .wuxing-item.jin {
            background: #FFD700;
            color: #8B4513;
        }

        .wuxing-item.mu {
            background: #90EE90;
            color: #006400;
        }

        .wuxing-item.shui {
            background: #87CEEB;
            color: #000080;
        }

        .wuxing-item.huo {
            background: #FFA500;
            color: #FF4500;
        }

        .wuxing-item.tu {
            background: #DEB887;
            color: #8B4513;
        }

        .name-results {
            display: grid;
            gap: 20px;
        }

        .name-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            border: 2px solid #ddd;
            transition: all 0.3s ease;
            position: relative;
        }

        .name-card:hover {
            border-color: #D2691E;
            box-shadow: 0 5px 15px rgba(210, 105, 30, 0.2);
        }

        .name-card.recommended {
            border-color: #FF6B6B;
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.05) 0%, rgba(255, 255, 255, 1) 100%);
        }

        .name-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .name-main {
            font-size: 2em;
            font-weight: bold;
            color: #8B4513;
        }

        .name-pinyin {
            color: #666;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .name-rating {
            display: flex;
            gap: 5px;
            align-items: center;
        }

        .star {
            color: #FFD700;
            font-size: 1.2em;
        }

        .rating-text {
            color: #666;
            font-size: 0.9em;
        }

        .name-meaning {
            margin: 15px 0;
            padding: 15px;
            background: rgba(210, 105, 30, 0.05);
            border-radius: 8px;
            border-left: 4px solid #D2691E;
        }

        .name-meaning h4 {
            color: #8B4513;
            margin-bottom: 10px;
        }

        .meaning-text {
            color: #666;
            line-height: 1.6;
        }

        .name-analysis {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .analysis-item {
            text-align: center;
            padding: 10px;
            background: rgba(210, 105, 30, 0.05);
            border-radius: 8px;
        }

        .analysis-item .label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .analysis-item .value {
            font-weight: bold;
            color: #8B4513;
        }

        .name-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .action-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        .save-btn {
            background: #28a745;
            color: white;
        }

        .save-btn:hover {
            background: #218838;
        }

        .share-btn {
            background: #007bff;
            color: white;
        }

        .share-btn:hover {
            background: #0056b3;
        }

        .favorite-btn {
            background: #ffc107;
            color: #212529;
        }

        .favorite-btn:hover {
            background: #e0a800;
        }

        .recommended-badge {
            position: absolute;
            top: -10px;
            right: -10px;
            background: #FF6B6B;
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .loading i {
            font-size: 3em;
            margin-bottom: 20px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .empty-state i {
            font-size: 3em;
            margin-bottom: 20px;
            color: #ddd;
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            font-size: 14px;
            z-index: 1000;
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.3s ease;
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        .saved-names {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border: 2px solid #8B4513;
            margin-top: 30px;
        }

        .saved-names h2 {
            color: #8B4513;
            margin-bottom: 25px;
            font-size: 1.8em;
            text-align: center;
            border-bottom: 2px solid #8B4513;
            padding-bottom: 10px;
        }

        .saved-list {
            display: grid;
            gap: 15px;
        }

        .saved-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 1px solid #ddd;
        }

        .saved-name {
            font-weight: bold;
            color: #8B4513;
            font-size: 1.2em;
        }

        .saved-info {
            color: #666;
            font-size: 0.9em;
        }

        .saved-actions {
            display: flex;
            gap: 10px;
        }

        .saved-actions button {
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8em;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 2em;
            }

            .features {
                flex-direction: column;
                gap: 15px;
            }

            .bazi-grid {
                grid-template-columns: 1fr;
            }

            .name-analysis {
                grid-template-columns: 1fr;
            }

            .checkbox-group {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-yin-yang"></i> 中文取名神器</h1>
            <p class="subtitle">专业的宝宝起名服务，结合生辰八字、五行、寓意分析</p>
            <div class="features">
                <div class="feature">
                    <i class="fas fa-calendar-alt"></i>
                    <span>生辰八字</span>
                </div>
                <div class="feature">
                    <i class="fas fa-balance-scale"></i>
                    <span>五行平衡</span>
                </div>
                <div class="feature">
                    <i class="fas fa-book"></i>
                    <span>寓意解析</span>
                </div>
                <div class="feature">
                    <i class="fas fa-star"></i>
                    <span>评分推荐</span>
                </div>
                <div class="feature">
                    <i class="fas fa-heart"></i>
                    <span>收藏保存</span>
                </div>
                <div class="feature">
                    <i class="fas fa-share-alt"></i>
                    <span>分享转发</span>
                </div>
            </div>
        </div>

        <div class="main-content">
            <div class="input-panel">
                <h2><i class="fas fa-edit"></i> 起名信息</h2>

                <div class="form-group">
                    <label for="babySurname">宝宝姓氏</label>
                    <input type="text" id="babySurname" placeholder="请输入宝宝姓氏" maxlength="2">
                </div>

                <div class="form-group">
                    <label for="babyGender">宝宝性别</label>
                    <select id="babyGender">
                        <option value="">请选择性别</option>
                        <option value="male">男孩</option>
                        <option value="female">女孩</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="birthDate">出生日期</label>
                    <input type="datetime-local" id="birthDate">
                </div>

                <div class="form-group">
                    <label for="birthTime">出生时间</label>
                    <select id="birthTime">
                        <option value="">请选择时辰</option>
                        <option value="23:00-01:00">子时 (23:00-01:00)</option>
                        <option value="01:00-03:00">丑时 (01:00-03:00)</option>
                        <option value="03:00-05:00">寅时 (03:00-05:00)</option>
                        <option value="05:00-07:00">卯时 (05:00-07:00)</option>
                        <option value="07:00-09:00">辰时 (07:00-09:00)</option>
                        <option value="09:00-11:00">巳时 (09:00-11:00)</option>
                        <option value="11:00-13:00">午时 (11:00-13:00)</option>
                        <option value="13:00-15:00">未时 (13:00-15:00)</option>
                        <option value="15:00-17:00">申时 (15:00-17:00)</option>
                        <option value="17:00-19:00">酉时 (17:00-19:00)</option>
                        <option value="19:00-21:00">戌时 (19:00-21:00)</option>
                        <option value="21:00-23:00">亥时 (21:00-23:00)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>取名要求</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="reqMeaning" value="meaning">
                            <label for="reqMeaning">寓意美好</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="reqUnique" value="unique">
                            <label for="reqUnique">独特少见</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="reqEasy" value="easy">
                            <label for="reqEasy">简单易写</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="reqModern" value="modern">
                            <label for="reqModern">现代时尚</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="reqTraditional" value="traditional">
                            <label for="reqTraditional">传统经典</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="reqLucky" value="lucky">
                            <label for="reqLucky">吉祥如意</label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="generation">辈分用字（可选）</label>
                    <input type="text" id="generation" placeholder="如：家、国、天、地等">
                </div>

                <div class="form-group">
                    <label for="avoidChars">忌讳字（可选）</label>
                    <input type="text" id="avoidChars" placeholder="用逗号分隔，如：死,病,穷">
                </div>

                <button class="generate-btn" onclick="generateNames()">
                    <i class="fas fa-magic"></i> 开始起名
                </button>
            </div>

            <div class="results-panel">
                <h2><i class="fas fa-star"></i> 起名结果</h2>

                <div id="resultsContent">
                    <div class="empty-state">
                        <i class="fas fa-baby"></i>
                        <h3>开始为您宝宝起名</h3>
                        <p>填写左侧信息，点击"开始起名"获取专业起名建议</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="saved-names">
            <h2><i class="fas fa-heart"></i> 收藏的名字</h2>
            <div id="savedNamesList" class="saved-list">
                <div class="empty-state">
                    <i class="fas fa-heart-broken"></i>
                    <p>暂无收藏的名字</p>
                </div>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        // 中文字符数据库
        const CHINESE_CHARS = {
            male: {
                common: [
                    {char: '伟', pinyin: 'wěi', meaning: '伟大、宏伟', wuxing: '土', score: 9},
                    {char: '杰', pinyin: 'jié', meaning: '杰出、卓越', wuxing: '木', score: 9},
                    {char: '浩', pinyin: 'hào', meaning: '浩大、广博', wuxing: '水', score: 8},
                    {char: '博', pinyin: 'bó', meaning: '博学、广博', wuxing: '水', score: 8},
                    {char: '瑞', pinyin: 'ruì', meaning: '吉祥、美好', wuxing: '金', score: 9},
                    {char: '强', pinyin: 'qiáng', meaning: '坚强、强大', wuxing: '木', score: 8},
                    {char: '鹏', pinyin: 'péng', meaning: '大鹏展翅', wuxing: '水', score: 9},
                    {char: '宇', pinyin: 'yǔ', meaning: '宇宙、气度', wuxing: '土', score: 8},
                    {char: '轩', pinyin: 'xuān', meaning: '气宇轩昂', wuxing: '土', score: 8},
                    {char: '哲', pinyin: 'zhé', meaning: '哲学、智慧', wuxing: '火', score: 9},
                    {char: '俊', pinyin: 'jùn', meaning: '英俊、才智', wuxing: '火', score: 8},
                    {char: '涛', pinyin: 'tāo', meaning: '波涛、气势', wuxing: '水', score: 8},
                    {char: '斌', pinyin: 'bīn', meaning: '文武双全', wuxing: '水', score: 8},
                    {char: '昊', pinyin: 'hào', meaning: '天空、广大', wuxing: '火', score: 8},
                    {char: '峰', pinyin: 'fēng', meaning: '高峰、杰出', wuxing: '土', score: 8}
                ],
                modern: [
                    {char: '宸', pinyin: 'chén', meaning: '帝王、尊贵', wuxing: '金', score: 9},
                    {char: '睿', pinyin: 'ruì', meaning: '睿智、聪明', wuxing: '金', score: 9},
                    {char: '泽', pinyin: 'zé', meaning: '恩泽、润泽', wuxing: '水', score: 9},
                    {char: '奕', pinyin: 'yì', meaning: '光明、盛大', wuxing: '木', score: 8},
                    {char: '霖', pinyin: 'lín', meaning: '甘霖、恩惠', wuxing: '水', score: 9},
                    {char: '铭', pinyin: 'míng', meaning: '铭记、铭刻', wuxing: '金', score: 8},
                    {char: '昕', pinyin: 'xīn', meaning: '黎明、希望', wuxing: '火', score: 8},
                    {char: '宸', pinyin: 'chén', meaning: '深远、博大', wuxing: '金', score: 9}
                ]
            },
            female: {
                common: [
                    {char: '美', pinyin: 'měi', meaning: '美丽、美好', wuxing: '水', score: 8},
                    {char: '丽', pinyin: 'lì', meaning: '美丽、华丽', wuxing: '火', score: 8},
                    {char: '芳', pinyin: 'fāng', meaning: '芬芳、美好', wuxing: '木', score: 8},
                    {char: '敏', pinyin: 'mǐn', meaning: '敏捷、聪敏', wuxing: '水', score: 8},
                    {char: '静', pinyin: 'jìng', meaning: '文静、安静', wuxing: '金', score: 8},
                    {char: '雅', pinyin: 'yǎ', meaning: '优雅、高雅', wuxing: '木', score: 9},
                    {char: '婷', pinyin: 'tíng', meaning: '婷婷玉立', wuxing: '火', score: 8},
                    {char: '慧', pinyin: 'huì', meaning: '智慧、聪慧', wuxing: '水', score: 9},
                    {char: '琳', pinyin: 'lín', meaning: '美玉、珍贵', wuxing: '木', score: 8},
                    {char: '娜', pinyin: 'nà', meaning: '婀娜、美丽', wuxing: '火', score: 8},
                    {char: '洁', pinyin: 'jié', meaning: '纯洁、干净', wuxing: '水', score: 8},
                    {char: '玲', pinyin: 'líng', meaning: '玲珑、巧妙', wuxing: '火', score: 8},
                    {char: '萍', pinyin: 'píng', meaning: '平安、平静', wuxing: '水', score: 8},
                    {char: '红', pinyin: 'hóng', meaning: '红火、热情', wuxing: '水', score: 7},
                    {char: '梅', pinyin: 'méi', meaning: '梅花、坚韧', wuxing: '木', score: 8}
                ],
                modern: [
                    {char: '诗', pinyin: 'shī', meaning: '诗意、文学', wuxing: '金', score: 9},
                    {char: '语', pinyin: 'yǔ', meaning: '语言、温柔', wuxing: '木', score: 8},
                    {char: '思', pinyin: 'sī', meaning: '思念、智慧', wuxing: '金', score: 8},
                    {char: '涵', pinyin: 'hán', meaning: '涵养、包容', wuxing: '水', score: 9},
                    {char: '蕊', pinyin: 'ruǐ', meaning: '花蕊、娇嫩', wuxing: '木', score: 8},
                    {char: '萱', pinyin: 'xuān', meaning: '萱草、忘忧', wuxing: '木', score: 8},
                    {char: '芷', pinyin: 'zhǐ', meaning: '白芷、香草', wuxing: '木', score: 9},
                    {char: '晴', pinyin: 'qíng', meaning: '晴朗、美好', wuxing: '火', score: 8}
                ]
            }
        };

        // 五行相生相克关系
        const WUXING_RELATIONS = {
            '金': ['土', '水'],
            '木': ['水', '火'],
            '水': ['金', '木'],
            '火': ['木', '土'],
            '土': ['火', '金']
        };

        // 十二地支对应的五行
        const EARTHLY_BRANCHES = {
            '子': '水', '丑': '土', '寅': '木', '卯': '木',
            '辰': '土', '巳': '火', '午': '火', '未': '土',
            '申': '金', '酉': '金', '戌': '土', '亥': '水'
        };

        // 应用状态
        let savedNames = JSON.parse(localStorage.getItem('savedNames')) || [];

        // 主要功能函数
        function generateNames() {
            const surname = document.getElementById('babySurname').value.trim();
            const gender = document.getElementById('babyGender').value;
            const birthDate = document.getElementById('birthDate').value;
            const birthTime = document.getElementById('birthTime').value;
            const generation = document.getElementById('generation').value.trim();
            const avoidChars = document.getElementById('avoidChars').value.trim();

            if (!surname) {
                showToast('请输入宝宝姓氏', 'warning');
                return;
            }

            if (!gender) {
                showToast('请选择宝宝性别', 'warning');
                return;
            }

            if (!birthDate) {
                showToast('请选择出生日期', 'warning');
                return;
            }

            // 显示加载状态
            document.getElementById('resultsContent').innerHTML = `
                <div class="loading">
                    <i class="fas fa-spinner"></i>
                    <h3>正在分析生辰八字...</h3>
                    <p>请稍候，我们正在为您的宝宝精心起名</p>
                </div>
            `;

            // 模拟计算过程
            setTimeout(() => {
                const results = generateNameResults(surname, gender, birthDate, birthTime, generation, avoidChars);
                displayResults(results);
            }, 2000);
        }

        function generateNameResults(surname, gender, birthDate, birthTime, generation, avoidChars) {
            // 计算生辰八字和五行
            const bazi = calculateBaZi(birthDate, birthTime);
            const wuxing = calculateWuXing(bazi);

            // 获取字符集合
            const charSet = getCharSet(gender);
            const avoidList = avoidChars ? avoidChars.split(',').map(s => s.trim()) : [];

            // 生成名字组合
            const names = [];
            const nameCount = 6;

            for (let i = 0; i < nameCount; i++) {
                const name = generateSingleName(surname, charSet, wuxing, generation, avoidList);
                names.push(name);
            }

            return {
                bazi,
                wuxing,
                names
            };
        }

        function calculateBaZi(birthDate, birthTime) {
            const date = new Date(birthDate);
            const year = date.getFullYear();
            const month = date.getMonth() + 1;
            const day = date.getDate();

            // 简化的八字计算（实际应用中需要更复杂的算法）
            const heavenlyStems = ['甲', '乙', '丙', '丁', '戊', '己', '庚', '辛', '壬', '癸'];
            const earthlyBranches = ['子', '丑', '寅', '卯', '辰', '巳', '午', '未', '申', '酉', '戌', '亥'];

            return {
                year: heavenlyStems[year % 10] + earthlyBranches[year % 12],
                month: heavenlyStems[(year + month) % 10] + earthlyBranches[(month + 2) % 12],
                day: heavenlyStems[(year + month + day) % 10] + earthlyBranches[(day + 2) % 12],
                time: birthTime ? birthTime.split(' ')[0] : '未知'
            };
        }

        function calculateWuXing(bazi) {
            // 根据八字计算五行
            const elements = { jin: 0, mu: 0, shui: 0, huo: 0, tu: 0 };

            // 分析八字中的五行
            Object.values(bazi).forEach(item => {
                if (item !== '未知') {
                    const branch = item.slice(-1);
                    const element = EARTHLY_BRANCHES[branch];
                    if (element && elements.hasOwnProperty(element)) {
                        elements[element]++;
                    }
                }
            });

            // 随机增加一些五行变化
            const elementKeys = Object.keys(elements);
            for (let i = 0; i < 3; i++) {
                const randomElement = elementKeys[Math.floor(Math.random() * elementKeys.length)];
                elements[randomElement]++;
            }

            return elements;
        }

        function getCharSet(gender) {
            const charSet = [...CHINESE_CHARS[gender].common, ...CHINESE_CHARS[gender].modern];

            // 获取用户选择的要求
            const requirements = [];
            document.querySelectorAll('.checkbox-item input[type="checkbox"]:checked').forEach(checkbox => {
                requirements.push(checkbox.value);
            });

            // 根据要求筛选字符
            let filteredChars = charSet;

            if (requirements.includes('meaning')) {
                filteredChars = filteredChars.filter(char => char.score >= 8);
            }

            if (requirements.includes('unique')) {
                filteredChars = filteredChars.filter(char => char.score >= 8);
            }

            if (requirements.includes('easy')) {
                filteredChars = filteredChars.filter(char => char.char.length === 1 && char.pinyin.length <= 4);
            }

            return filteredChars;
        }

        function generateSingleName(surname, charSet, wuxing, generation, avoidList) {
            // 确定缺的五行
            const wuxingCounts = Object.entries(wuxing).sort((a, b) => a[1] - b[1]);
            const lackingWuxing = wuxingCounts.slice(0, 2).map(item => item[0]);

            // 筛选适合的字符
            let suitableChars = charSet.filter(char => {
                // 避开忌讳字
                if (avoidList.some(avoid => char.char.includes(avoid))) {
                    return false;
                }

                // 优先选择缺失五行的字符
                return lackingWuxing.includes(char.wuxing);
            });

            // 如果没有合适的字符，则使用所有字符
            if (suitableChars.length < 2) {
                suitableChars = charSet.filter(char =>
                    !avoidList.some(avoid => char.char.includes(avoid))
                );
            }

            // 随机选择字符
            const char1 = suitableChars[Math.floor(Math.random() * suitableChars.length)];
            const char2 = suitableChars[Math.floor(Math.random() * suitableChars.length)];

            // 如果有辈分字，优先使用
            let finalName = '';
            if (generation) {
                finalName = generation + char2.char;
            } else {
                finalName = char1.char + char2.char;
            }

            // 计算分数
            const score = calculateNameScore(surname + finalName, char1, char2, wuxing);

            return {
                surname: surname,
                name: finalName,
                pinyin: generation ?
                    `${getPinyin(generation)} ${char2.pinyin}` :
                    `${char1.pinyin} ${char2.pinyin}`,
                meaning: `${char1.meaning}，${char2.meaning}`,
                score: score,
                wuxing: [char1.wuxing, char2.wuxing],
                analysis: {
                    totalScore: score,
                    meaningScore: (char1.score + char2.score) / 2,
                    wuxingScore: calculateWuxingScore([char1.wuxing, char2.wuxing], wuxing),
                    uniquenessScore: Math.random() * 2 + 8
                }
            };
        }

        function getPinyin(text) {
            // 简化的拼音转换（实际应用中需要完整的拼音库）
            const pinyinMap = {
                '家': 'jiā', '国': 'guó', '天': 'tiān', '地': 'dì', '人': 'rén', '和': 'hé', '平': 'píng'
            };
            return pinyinMap[text] || 'unknown';
        }

        function calculateNameScore(fullName, char1, char2, wuxing) {
            let score = 0;

            // 字义分数
            score += (char1.score + char2.score) / 2 * 0.4;

            // 五行平衡分数
            score += calculateWuxingScore([char1.wuxing, char2.wuxing], wuxing) * 0.3;

            // 独特性分数
            score += (Math.random() * 2 + 8) * 0.2;

            // 音律分数
            score += (Math.random() * 2 + 8) * 0.1;

            return Math.round(score);
        }

        function calculateWuxingScore(nameWuxing, personWuxing) {
            const nameWuxingCount = {};
            nameWuxing.forEach(wx => {
                nameWuxingCount[wx] = (nameWuxingCount[wx] || 0) + 1;
            });

            let score = 0;
            Object.entries(personWuxing).forEach(([element, count]) => {
                if (nameWuxingCount[element]) {
                    score += Math.min(count, nameWuxingCount[element]) * 2;
                }
            });

            return Math.min(score, 10);
        }

        function displayResults(results) {
            const html = `
                <div class="bazi-info">
                    <h3><i class="fas fa-calendar-alt"></i> 生辰八字分析</h3>
                    <div class="bazi-grid">
                        <div class="bazi-item">
                            <span class="label">年柱</span>
                            <span class="value">${results.bazi.year}</span>
                        </div>
                        <div class="bazi-item">
                            <span class="label">月柱</span>
                            <span class="value">${results.bazi.month}</span>
                        </div>
                        <div class="bazi-item">
                            <span class="label">日柱</span>
                            <span class="value">${results.bazi.day}</span>
                        </div>
                        <div class="bazi-item">
                            <span class="label">时柱</span>
                            <span class="value">${results.bazi.time}</span>
                        </div>
                    </div>

                    <h4 style="margin-top: 20px; margin-bottom: 10px;">五行分析</h4>
                    <div class="wuxing-info">
                        <div class="wuxing-item jin">金 ${results.wuxing.jin}</div>
                        <div class="wuxing-item mu">木 ${results.wuxing.mu}</div>
                        <div class="wuxing-item shui">水 ${results.wuxing.shui}</div>
                        <div class="wuxing-item huo">火 ${results.wuxing.huo}</div>
                        <div class="wuxing-item tu">土 ${results.wuxing.tu}</div>
                    </div>
                </div>

                <div class="name-results">
                    ${results.names.map((name, index) => `
                        <div class="name-card ${index === 0 ? 'recommended' : ''}">
                            ${index === 0 ? '<div class="recommended-badge">推荐</div>' : ''}
                            <div class="name-header">
                                <div>
                                    <div class="name-main">${name.surname}${name.name}</div>
                                    <div class="name-pinyin">${name.pinyin}</div>
                                </div>
                                <div class="name-rating">
                                    <div class="stars">
                                        ${generateStars(name.score)}
                                    </div>
                                    <div class="rating-text">${name.score}分</div>
                                </div>
                            </div>

                            <div class="name-meaning">
                                <h4><i class="fas fa-book"></i> 寓意解析</h4>
                                <div class="meaning-text">${name.meaning}</div>
                            </div>

                            <div class="name-analysis">
                                <div class="analysis-item">
                                    <div class="label">字义评分</div>
                                    <div class="value">${name.analysis.meaningScore.toFixed(1)}</div>
                                </div>
                                <div class="analysis-item">
                                    <div class="label">五行评分</div>
                                    <div class="value">${name.analysis.wuxingScore.toFixed(1)}</div>
                                </div>
                                <div class="analysis-item">
                                    <div class="label">独特性</div>
                                    <div class="value">${name.analysis.uniquenessScore.toFixed(1)}</div>
                                </div>
                                <div class="analysis-item">
                                    <div class="label">五行属性</div>
                                    <div class="value">${name.wuxing.join('、')}</div>
                                </div>
                            </div>

                            <div class="name-actions">
                                <button class="action-btn save-btn" onclick="saveName('${name.surname}${name.name}', '${name.pinyin}', '${name.meaning}', ${name.score})">
                                    <i class="fas fa-heart"></i> 收藏
                                </button>
                                <button class="action-btn share-btn" onclick="shareName('${name.surname}${name.name}')">
                                    <i class="fas fa-share-alt"></i> 分享
                                </button>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;

            document.getElementById('resultsContent').innerHTML = html;
            showToast('起名完成！请查看推荐结果', 'success');
        }

        function generateStars(score) {
            const fullStars = Math.floor(score / 2);
            const hasHalfStar = score % 2 >= 1;
            let stars = '';

            for (let i = 0; i < fullStars; i++) {
                stars += '<i class="fas fa-star star"></i>';
            }

            if (hasHalfStar) {
                stars += '<i class="fas fa-star-half-alt star"></i>';
            }

            const emptyStars = 5 - Math.ceil(score / 2);
            for (let i = 0; i < emptyStars; i++) {
                stars += '<i class="far fa-star star"></i>';
            }

            return stars;
        }

        function saveName(name, pinyin, meaning, score) {
            const nameData = {
                name,
                pinyin,
                meaning,
                score,
                savedAt: new Date().toLocaleString()
            };

            savedNames.push(nameData);
            localStorage.setItem('savedNames', JSON.stringify(savedNames));
            updateSavedNamesList();
            showToast('名字已收藏！', 'success');
        }

        function shareName(name) {
            const shareText = `我为宝宝取了一个好名字：${name}，用中文取名神器取的，很专业哦！`;

            if (navigator.share) {
                navigator.share({
                    title: '中文取名神器',
                    text: shareText,
                    url: window.location.href
                });
            } else {
                // 复制到剪贴板
                navigator.clipboard.writeText(shareText).then(() => {
                    showToast('分享内容已复制到剪贴板', 'success');
                });
            }
        }

        function updateSavedNamesList() {
            const container = document.getElementById('savedNamesList');

            if (savedNames.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-heart-broken"></i>
                        <p>暂无收藏的名字</p>
                    </div>
                `;
                return;
            }

            const html = savedNames.map((item, index) => `
                <div class="saved-item">
                    <div>
                        <div class="saved-name">${item.name}</div>
                        <div class="saved-info">${item.pinyin} - ${item.score}分</div>
                    </div>
                    <div class="saved-actions">
                        <button onclick="shareName('${item.name}')" style="background: #007bff; color: white;">
                            分享
                        </button>
                        <button onclick="removeSavedName(${index})" style="background: #dc3545; color: white;">
                            删除
                        </button>
                    </div>
                </div>
            `).join('');

            container.innerHTML = html;
        }

        function removeSavedName(index) {
            if (confirm('确定要删除这个收藏的名字吗？')) {
                savedNames.splice(index, 1);
                localStorage.setItem('savedNames', JSON.stringify(savedNames));
                updateSavedNamesList();
                showToast('已删除收藏', 'success');
            }
        }

        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast show';

            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            updateSavedNamesList();

            // 设置默认日期为今天
            const today = new Date();
            const dateStr = today.toISOString().slice(0, 16);
            document.getElementById('birthDate').value = dateStr;
        });
    </script>
</body>
</html>